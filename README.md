# Race Bot
### Бот, созданный для организации гонок в формате Alleycat race.

---
## Технологии
- Python 3.9
- Python-Telegram-Bot 20.4
- Язык SQL
- Poetry для управления зависимостями
- Asyncio для написания асинхронного кода на основе корутин
- Переменные окружение python-dotenv
- Aiosqlite для асинхронных запросов к БД SQLite
___
## Описание

В БД загружаются все координаты контрольных точек и соответствующие задания.
Райдер - участник гонки - регистрируется в боте и начинает гонку, отправляя
стартовую геолокацию и свою фотографию, которые бот фиксирует, пересылая
данные в специальный чат организаторов. Получив порядковый номер, райдер при
помощи специальной команды получает контрольную точку и задание, которое он 
должен выполнить по достижению метки. Райдер вновь отправляет геометку и 
фотографию, бот фиксирует время прохождения точки в базе данных и пересылает
данные райдера в чат администраторов. Райдер по той же команде получает
следующую контрольную точку. В случае, если райдер прошел все контрольные 
точки, он получает соответствующее сообщение и свое время прохождения, которое
фиксируется от времени старта прохождения первой контрольной точки до 
времени финиша последней. Результаты прохождения всех точек фиксируются и 
выводятся при вызове специальной команды. 

Организаторы должны иметь возможность иметь доступ к списку участников,
контрольных точек и результатов, изменять/удалять их. Должна быть верификация
по секретному ключу, которая предоставит тому или иному участнику (юзеру в БД) 
права администратора.
___
## Общий функционал

### Основные команды:

<code>/start</code> - выводит документацию со списком доступных команд

<code>/register</code> - регистрирует пользователя в базе данных

<code>/start_race</code> - стартует гонку для зарегистрированного пользователя,
фиксирует стартовые геолокацию и фотографию участника. Обновляет список
контрольных точек для участника, вызвавшего команду. Если пользователь не
зарегистрирован, выводит сообщение об этом

<code>/go</code> - выводит контрольную точку 
зарегистрированному и начавшему гонку участнику, фиксирует геолокацию и фото 
выполнения по достижению точки

___

### Команды для организаторов:

<code>/admin</code> - для зарегистрированного пользователя начинает процедуру
получения прав администратора через секретный ключ

<code>/participants</code> - выводит список всех зарегистрированных
пользователей с информацией об участии в гонке и админских правах

<code>/points</code> - выводит список контрольных точек с координатами
и заданиями к выполнению

<code>/results</code> - выводит участников и их контрольные точки, со временем
старта и временем завершения для каждой из контрольных точек. Доступен просмотр
результатов как всех участников, так и определенного участника по его ID
из списка /participants

<code>/overall_results</code> - список участников, которые завершили гонку,
пройдя все контрольные точки. Отсортирован по времени прохождения в порядке
возрастания

___

### Управление точками и участниками (для организаторов):

<code>/add_point</code> - добавляет контрольную точку с указанием координат
и задания для выполнения по достижению

<code>/del_points</code> - удаляет контрольные точки с
возможностью удаления как всех контрольных точек, так и некоторых из них по ID
точек

<code>/del_participants</code> - удаляет всех зарегистрированных пользователей
из базы данных, кроме администраторов. Требует подтверждения действия

<code>/del_results</code> - удаляет записи всех результатов из базы данных.
Требует подтверждения действия

___
## Инструкция по запуску

- Клонировать репозиторий и перейти в него в командной строке bash

```bash
git clone git@github.com:d2avids/race_bot.git
```

- Перейти в папку с проектом

```bash
cd race_bot/
```

- Установить менеджер зависимостей Poetry

```bash
pip install poetry
```

- Установить зависимости

```bash
poetry install
```

- Активировать виртуальное окружение
```bash
poetry shell
```

- Создать файл env и заполнить его переменными окружения по примеру файла env_example

```bash
touch .env
```

- Запустить бот
```bash
python race_bot.py
```

---
## Автор

**Имя:** *David Saidov*

**Email:** *delightxxls@gmail.com*
